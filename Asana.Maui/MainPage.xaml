<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Asana.Maui.MainPage"
             Title="Task Manager">

       <Grid RowDefinitions="Auto,Auto,Auto,*"
             Padding="20">

              <!-- Header with Action Buttons -->
              <VerticalStackLayout Grid.Row="0"
                                   Spacing="15"
                                   Margin="0,0,0,20">
                     <Label Text="Task Manager"
                            FontSize="24"
                            FontAttributes="Bold"
                            HorizontalOptions="Center"/>

                     <!-- Action Buttons -->
                     <HorizontalStackLayout Spacing="15"
                                            HorizontalOptions="Center">
                            <Button Text="+ Add Task"
                                    Command="{Binding ToggleAddTaskFormCommand}"
                                    BackgroundColor="#007AFF"
                                    TextColor="White"
                                    WidthRequest="140"
                                    HeightRequest="50"
                                    CornerRadius="25"/>

                            <Button Text="+ Add Project"
                                    Command="{Binding ToggleAddProjectFormCommand}"
                                    BackgroundColor="#34C759"
                                    TextColor="White"
                                    WidthRequest="140"
                                    HeightRequest="50"
                                    CornerRadius="25"/>
                     </HorizontalStackLayout>

                     <!-- Quick Stats -->
                     <HorizontalStackLayout Spacing="20"
                                            HorizontalOptions="Center">
                            <Frame BackgroundColor="#f8f9fa"
                                   Padding="10,5"
                                   CornerRadius="15">
                                   <Label Text="{Binding TaskCount, StringFormat='{0} Tasks'}"
                                          FontSize="12"
                                          TextColor="#666"/>
                            </Frame>

                            <Frame BackgroundColor="#f8f9fa"
                                   Padding="10,5"
                                   CornerRadius="15">
                                   <Label Text="{Binding ProjectCount, StringFormat='{0} Projects'}"
                                          FontSize="12"
                                          TextColor="#666"/>
                            </Frame>
                     </HorizontalStackLayout>
              </VerticalStackLayout>

              <!-- Add Task Form (Collapsible) -->
              <Frame Grid.Row="1"
                     IsVisible="{Binding ShowAddTaskForm}"
                     BackgroundColor="#f0f0f0"
                     BorderColor="#007AFF"
                     CornerRadius="10"
                     Padding="15"
                     Margin="0,0,0,10">
                     <VerticalStackLayout Spacing="10">
                            <Grid ColumnDefinitions="*,Auto">
                                   <Label Grid.Column="0"
                                          Text="Add New Task"
                                          FontSize="18"
                                          FontAttributes="Bold"
                                          VerticalOptions="Center"/>
                                   <Button Grid.Column="1"
                                           Text="✕"
                                           Command="{Binding ToggleAddTaskFormCommand}"
                                           BackgroundColor="Transparent"
                                           TextColor="#007AFF"
                                           FontSize="16"
                                           WidthRequest="30"
                                           HeightRequest="30"/>
                            </Grid>

                            <!-- Task Name -->
                            <Entry Placeholder="Task Name"
                                   Text="{Binding NewToDoName}"/>

                            <!-- Task Description -->
                            <Entry Placeholder="Task Description (Optional)"
                                   Text="{Binding NewToDoDescription}"/>

                            <!-- Priority Selection -->
                            <HorizontalStackLayout Spacing="10">
                                   <Label Text="Priority:"
                                          VerticalOptions="Center"/>

                                   <HorizontalStackLayout Spacing="5">
                                          <Button Text="1"
                                                  BackgroundColor="{Binding Priority1Color}"
                                                  Command="{Binding SetPriorityCommand}"
                                                  CommandParameter="1"
                                                  TextColor="White"
                                                  WidthRequest="40"
                                                  HeightRequest="40"
                                                  CornerRadius="20"/>
                                          <Button Text="2"
                                                  BackgroundColor="{Binding Priority2Color}"
                                                  Command="{Binding SetPriorityCommand}"
                                                  CommandParameter="2"
                                                  TextColor="White"
                                                  WidthRequest="40"
                                                  HeightRequest="40"
                                                  CornerRadius="20"/>
                                          <Button Text="3"
                                                  BackgroundColor="{Binding Priority3Color}"
                                                  Command="{Binding SetPriorityCommand}"
                                                  CommandParameter="3"
                                                  TextColor="White"
                                                  WidthRequest="40"
                                                  HeightRequest="40"
                                                  CornerRadius="20"/>
                                   </HorizontalStackLayout>
                            </HorizontalStackLayout>

                            <!-- Due Date -->
                            <HorizontalStackLayout Spacing="10">
                                   <Label Text="Due Date:"
                                          VerticalOptions="Center"/>
                                   <DatePicker Date="{Binding NewToDoDueDate}"
                                               Format="MMM dd, yyyy"
                                               VerticalOptions="Center"/>
                            </HorizontalStackLayout>

                            <!-- Project Selection -->
                            <HorizontalStackLayout Spacing="10">
                                   <Label Text="Project:"
                                          VerticalOptions="Center"/>
                                   <Button Text="{Binding SelectedProjectDisplay}"
                                           Command="{Binding ShowProjectSelectorCommand}"
                                           BackgroundColor="White"
                                           TextColor="Black"
                                           WidthRequest="200"
                                           HeightRequest="40"
                                           CornerRadius="8"/>
                            </HorizontalStackLayout>

                            <!-- Create Button -->
                            <Button Text="Create Task"
                                    Command="{Binding AddToDoCommand}"
                                    BackgroundColor="#007AFF"
                                    TextColor="White"
                                    HeightRequest="45"
                                    CornerRadius="8"
                                    Margin="0,10,0,0"/>
                     </VerticalStackLayout>
              </Frame>

              <!-- Add Project Form (Collapsible) -->
              <Frame Grid.Row="2"
                     IsVisible="{Binding ShowAddProjectForm}"
                     BackgroundColor="#f0f0f0"
                     BorderColor="#34C759"
                     CornerRadius="10"
                     Padding="15"
                     Margin="0,0,0,10">
                     <VerticalStackLayout Spacing="10">
                            <Grid ColumnDefinitions="*,Auto">
                                   <Label Grid.Column="0"
                                          Text="Add New Project"
                                          FontSize="18"
                                          FontAttributes="Bold"
                                          VerticalOptions="Center"/>
                                   <Button Grid.Column="1"
                                           Text="✕"
                                           Command="{Binding ToggleAddProjectFormCommand}"
                                           BackgroundColor="Transparent"
                                           TextColor="#34C759"
                                           FontSize="16"
                                           WidthRequest="30"
                                           HeightRequest="30"/>
                            </Grid>

                            <!-- Project Name -->
                            <Entry Placeholder="Project Name"
                                   Text="{Binding NewProjectName}"/>

                            <!-- Project Description -->
                            <Entry Placeholder="Project Description (Optional)"
                                   Text="{Binding NewProjectDescription}"/>

                            <!-- Create Button -->
                            <Button Text="Create Project"
                                    Command="{Binding AddProjectCommand}"
                                    BackgroundColor="#34C759"
                                    TextColor="White"
                                    HeightRequest="45"
                                    CornerRadius="8"
                                    Margin="0,10,0,0"/>
                     </VerticalStackLayout>
              </Frame>

              <!-- Content Lists -->
              <ScrollView Grid.Row="3">
                     <VerticalStackLayout Spacing="25">

                            <!-- Tasks Section -->
                            <VerticalStackLayout Spacing="15">
                                   <Label Text="Tasks"
                                          FontSize="20"
                                          FontAttributes="Bold"/>

                                   <CollectionView ItemsSource="{Binding ToDos}"
                                                   SelectedItem="{Binding SelectedToDo}"
                                                   SelectionMode="Single">
                                          <CollectionView.EmptyView>
                                                 <StackLayout Padding="40">
                                                        <Label Text="📝"
                                                               FontSize="40"
                                                               HorizontalOptions="Center"/>
                                                        <Label Text="No tasks yet!"
                                                               HorizontalOptions="Center"
                                                               FontSize="16"
                                                               TextColor="Gray"/>
                                                        <Label Text="Tap 'Add Task' to get started"
                                                               HorizontalOptions="Center"
                                                               FontSize="14"
                                                               TextColor="LightGray"/>
                                                 </StackLayout>
                                          </CollectionView.EmptyView>

                                          <CollectionView.ItemTemplate>
                                                 <DataTemplate>
                                                        <Frame Margin="0,5"
                                                               Padding="15"
                                                               BackgroundColor="White"
                                                               BorderColor="#e1e1e1"
                                                               CornerRadius="10">
                                                               <Grid ColumnDefinitions="Auto,*,Auto"
                                                                     RowDefinitions="Auto,Auto,Auto">

                                                                      <!-- Completion Checkbox -->
                                                                      <CheckBox Grid.Row="0"
                                                                                Grid.Column="0"
                                                                                Grid.RowSpan="2"
                                                                                IsChecked="{Binding IsComplete}"
                                                                                VerticalOptions="Center"
                                                                                CheckedChanged="OnToDoCompleteChanged"/>

                                                                      <!-- Task Content -->
                                                                      <Label Grid.Row="0"
                                                                             Grid.Column="1"
                                                                             Text="{Binding Name}"
                                                                             FontSize="16"
                                                                             FontAttributes="Bold"/>

                                                                      <Label Grid.Row="1"
                                                                             Grid.Column="1"
                                                                             Text="{Binding Description}"
                                                                             FontSize="14"
                                                                             TextColor="Gray"
                                                                             IsVisible="{Binding Description}"/>

                                                                      <!-- Task Details -->
                                                                      <HorizontalStackLayout Grid.Row="2"
                                                                                             Grid.Column="1"
                                                                                             Spacing="10"
                                                                                             Margin="0,5,0,0">
                                                                             <Frame BackgroundColor="#f1f3f4"
                                                                                    Padding="5"
                                                                                    CornerRadius="5"
                                                                                    HasShadow="False">
                                                                                    <Label Text="{Binding Priority, StringFormat='Priority {0}'}"
                                                                                           FontSize="12"/>
                                                                             </Frame>

                                                                             <Frame BackgroundColor="#f1f3f4"
                                                                                    Padding="5"
                                                                                    CornerRadius="5"
                                                                                    HasShadow="False">
                                                                                    <Label Text="{Binding DueDate, StringFormat='Due {0:MMM dd}'}"
                                                                                           FontSize="12"/>
                                                                             </Frame>

                                                                             <Frame BackgroundColor="#e3f2fd"
                                                                                    Padding="5"
                                                                                    CornerRadius="5"
                                                                                    HasShadow="False"
                                                                                    IsVisible="{Binding ProjectId}">
                                                                                    <Label Text="{Binding ProjectDisplayName}"
                                                                                           FontSize="12"/>
                                                                             </Frame>
                                                                      </HorizontalStackLayout>

                                                                      <!-- Action Buttons -->
                                                                      <HorizontalStackLayout Grid.Row="0"
                                                                                             Grid.Column="2"
                                                                                             Grid.RowSpan="2"
                                                                                             Spacing="5"
                                                                                             VerticalOptions="Center">
                                                                             <Button Text="Edit"
                                                                                     Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.EditToDoCommand}"
                                                                                     CommandParameter="{Binding .}"
                                                                                     BackgroundColor="#007AFF"
                                                                                     TextColor="White"
                                                                                     FontSize="12"
                                                                                     Padding="8,4"
                                                                                     CornerRadius="5"/>

                                                                             <Button Text="Delete"
                                                                                     Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DeleteToDoCommand}"
                                                                                     CommandParameter="{Binding .}"
                                                                                     BackgroundColor="#FF3B30"
                                                                                     TextColor="White"
                                                                                     FontSize="12"
                                                                                     Padding="8,4"
                                                                                     CornerRadius="5"/>
                                                                      </HorizontalStackLayout>
                                                               </Grid>
                                                        </Frame>
                                                 </DataTemplate>
                                          </CollectionView.ItemTemplate>
                                   </CollectionView>
                            </VerticalStackLayout>

                            <!-- Projects Section -->
                            <VerticalStackLayout Spacing="15">
                                   <Label Text="Projects"
                                          FontSize="20"
                                          FontAttributes="Bold"/>

                                   <CollectionView ItemsSource="{Binding Projects}"
                                                   SelectedItem="{Binding SelectedProject}"
                                                   SelectionMode="Single">
                                          <CollectionView.EmptyView>
                                                 <StackLayout Padding="40">
                                                        <Label Text="📁"
                                                               FontSize="40"
                                                               HorizontalOptions="Center"/>
                                                        <Label Text="No projects yet!"
                                                               HorizontalOptions="Center"
                                                               FontSize="16"
                                                               TextColor="Gray"/>
                                                        <Label Text="Tap 'Add Project' to create one"
                                                               HorizontalOptions="Center"
                                                               FontSize="14"
                                                               TextColor="LightGray"/>
                                                 </StackLayout>
                                          </CollectionView.EmptyView>

                                          <CollectionView.ItemTemplate>
                                                 <DataTemplate>
                                                        <Frame Margin="0,5"
                                                               Padding="15"
                                                               BackgroundColor="White"
                                                               BorderColor="#e1e1e1"
                                                               CornerRadius="10">
                                                               <Grid ColumnDefinitions="*,Auto">
                                                                      <VerticalStackLayout Grid.Column="0"
                                                                                           Spacing="5">
                                                                             <Label Text="{Binding Name}"
                                                                                    FontSize="16"
                                                                                    FontAttributes="Bold"/>

                                                                             <Label Text="{Binding Description}"
                                                                                    FontSize="14"
                                                                                    TextColor="Gray"
                                                                                    IsVisible="{Binding Description}"/>
                                                                      </VerticalStackLayout>

                                                                      <Button Grid.Column="1"
                                                                              Text="Delete"
                                                                              Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DeleteProjectCommand}"
                                                                              CommandParameter="{Binding .}"
                                                                              BackgroundColor="#FF3B30"
                                                                              TextColor="White"
                                                                              FontSize="12"
                                                                              Padding="8,4"
                                                                              CornerRadius="5"
                                                                              VerticalOptions="Center"/>
                                                               </Grid>
                                                        </Frame>
                                                 </DataTemplate>
                                          </CollectionView.ItemTemplate>
                                   </CollectionView>
                            </VerticalStackLayout>

                     </VerticalStackLayout>
              </ScrollView>
       </Grid>
</ContentPage>